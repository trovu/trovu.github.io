digraph {

  node [shape="rectangle"]

  subgraph cluster_input {
    label="User input";
    style=filled;
    color=gray90;
    query [label="Query: g foobar"];
  }
  subgraph cluster_settings {
    label="Settings";
    style=filled;
    color=gray90;
    namespaceUrlTemplates -> namespaceOrder [style="invis"];
    namespaceOrder ->  variables [style="invis"];
    variables [label="Variables\nLanguage: de\nCountry: .de"]
    namespaceOrder [label="Namespace order: o, de, .de, johndoe"];
    namespaceUrlTemplates [label="Namespace URL templates
o: https://raw.githubusercontent.com/trovu/trovu-data/master/shortcuts\n/o/{%keyword}/{%argumentCount}.txt
de: https://raw.githubusercontent.com/trovu/trovu-data/master/shortcuts\n/de/{%keyword}/{%argumentCount}.txt
.de: https://raw.githubusercontent.com/trovu/trovu-data/master/shortcuts\n/.de/{%keyword}/{%argumentCount}.txt
johndoe: https://example.com/trovu/{%keyword}.{%argumentCount}.txt
"];
  }
  subgraph cluster_output {
    label="Output / redirect user there";
    labelloc=b;
    style=filled;
    color=gray90;
    redirectUrlReplacedArguments[label="https://www.google.de/search?hl=de&q=foobar&ie=utf-8"]
  }

  parsedQuery [label="keyword: g\narguments: ['foobar']\nargumentCount: 1"];
  shortcutFetchUrls [label="Shortcut fetch URLs
o: https://raw.githubusercontent.com/trovu/trovu-data/master/shortcuts/o/g/1.txt
de: https://raw.githubusercontent.com/trovu/trovu-data/master/shortcuts/de/g/1.txt
.de: https://raw.githubusercontent.com/trovu/trovu-data/master/shortcuts/.de/g/1.txt
johndoe: https://example.com/trovu/g.1.txt
"];

  responseO [label="Success (200)"];
  responseDe [label="Not Found (404)"];
  responseDotDe [label="Success (200)"];
  responseJohnDoe [label="Not Found (404)"];
  redirectUrlDotDe [label="https://www.google.de/search?hl={$language}&q={%query}&ie=utf-8"];
  query->parsedQuery [label="parse query"];
  parsedQuery->shortcutFetchUrls [label="build fetch URLs"];
  namespaceUrlTemplates->shortcutFetchUrls [label="build fetch URLs"];
  shortcutFetchUrls -> responseO [label="request o"];
  shortcutFetchUrls -> responseDe [label="request de"];
  shortcutFetchUrls -> responseDotDe [label="request .de"];
  shortcutFetchUrls -> responseJohnDoe [label="request johndoe"];
  responseO -> pickedNamespace;
  responseDotDe -> pickedNamespace;
  namespaceOrder -> pickedNamespace [label="pick namespace according to order"];
  pickedNamespace [label="Picked namespace: .de"]
  pickedNamespace -> redirectUrlDotDe [label="read file from .de request\nhttps://raw.githubusercontent.com/trovu/trovu-data/master/shortcuts/.de/g/1.txt"];
  redirectUrlReplacedVariables[label="https://www.google.de/search?hl=de&q={%query}&ie=utf-8"]
  redirectUrlDotDe -> redirectUrlReplacedVariables [label="replace variables"];
  variables -> redirectUrlReplacedVariables [label="replace variables"];
  parsedQuery -> redirectUrlReplacedArguments [label="replace arguments"];
  redirectUrlReplacedVariables -> redirectUrlReplacedArguments [label="replace arguments"];
}
